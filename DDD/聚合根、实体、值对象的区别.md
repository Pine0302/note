**1.** **聚合根、实体、值对象的区别？**

**从标识的角度：**

聚合根具有全局的唯一标识，而实体只有在聚合内部有唯一的本地标识，值对象没有唯一标识，不存在这个值对象或那个值对象的说法；

**从是否只读的角度：**

聚合根除了唯一标识外，其他所有状态信息都理论上可变；实体是可变的；值对象是只读的；

**从生命周期的角度：**

聚合根有独立的生命周期，实体的生命周期从属于其所属的聚合，实体完全由其所属的聚合根负责管理维护；值对象无生命周期可言，因为只是一个值；

**2.** **聚合根、实体、值对象对象之间如何建立关联？**

聚合根到聚合根：通过ID关联；

聚合根到其内部的实体，直接对象引用；

聚合根到值对象，直接对象引用；

实体对其他对象的引用规则：1）能引用其所属聚合内的聚合根、实体、值对象；2）能引用外部聚合根，但推荐以ID的方式关联，另外也可以关联某个外部聚合内的实体，但必须是ID关联，否则就出现同一个实体的引用被两个聚合根持有，这是不允许的，一个实体的引用只能被其所属的聚合根持有；

值对象对其他对象的引用规则：只需确保值对象是只读的即可，推荐值对象的所有属性都尽量是值对象；

**3.** **如何识别聚合与聚合根？**

明确含义：一个Bounded Context（界定的上下文）可能包含多个聚合，每个聚合都有一个根实体，叫做聚合根；

识别顺序：先找出哪些实体可能是聚合根，再逐个分析每个聚合根的边界，即该聚合根应该聚合哪些实体或值对象；最后再划分Bounded Context；

聚合边界确定法则：根据不变性约束规则（Invariant）。不变性规则有两类：1）聚合边界内必须具有哪些信息，如果没有这些信息就不能称为一个有效的聚合；2）聚合内的某些对象的状态必须满足某个业务规则；

**例子分析1****：订单模型**

Order（一 个订单）必须有对应的客户信息，否则就不能称为一个有效的Order；
同理，Order对OrderLineItem有不变性约束，Order也必须至少有一个OrderLineItem(一条订单明细)，否 则就不能称为一个有效的Order；
另外，Order中的任何OrderLineItem的数量都不能为0，否则认为该OrderLineItem是无效 的，同时可以推理出Order也可能是无效的。因为如果允许一个OrderLineItem的数量为0的话，就意味着可能会出现所有 OrderLineItem的数量都为0，这就导致整个Order的总价为0，这是没有任何意义的，是不允许的，从而导致Order无效；所以，必须要求 Order中所有的OrderLineItem的数量都不能为0；
那么现在可以确定的是Order必须包含一些OrderLineItem，那么应该是通 过引用的方式还是ID关联的方式来表达这种包含关系呢？
这就需要引出另外一个问题，那就是先要分析出是OrderLineItem是否是一个独立的聚合 根。回答了这个问题，那么根据上面的规则就知道应该用对象引用还是用ID关联了。
那么OrderLineItem是否是一个独立的聚合根呢？
因为聚合根意 味着是某个聚合的根，而聚合有代表着某个上下文边界，而一个上下文边界又代表着某个独立的业务场景，这个业务场景操作的唯一对象总是该上下文边界内的聚合 根。
想到这里，我们就可以想想，有没有什么场景是会绕开订单直接对某个订单明细进行操作的。
也就是在这种情况下，我们 是以OrderLineItem为主体，完全是在面向OrderLineItem在做业务操作。有这种业务场景吗？
没有，我们对 OrderLineItem的所有的操作都是以Order为出发点，我们总是会面向整个Order在做业务操作，比如向Order中增加明细，修改 Order的某个明细对应的商品的购买数量，从Order中移除某个明细，等等类似操作，我们从来不会从OrderlineItem为出发点去执行一些业 务操作；
另外，从生命周期的角度去理解，那么OrderLineItem离开Order没有任何存在的意义，也就是说OrderLineItem的生命周 期是从属于Order的。
所以，我们可以很确信的回答，OrderLineItem是一个实体。

**例子分析2****：帖子与回复的模型，做个对比，以便更好地理解。**

不 变性分析：帖子和回复之间有不变性规则吗？似乎我们只知道一点是肯定的，那就是帖子和回复之间的关系，1：N的关系；除了这个之外，我们看不到任何其他的 不变性规则。那么这个1：N的对象关系是一种不变性规则吗？不是！首先，一个帖子可以没有任何回复，帖子也不对它的回复有任何规则约束，它甚至都不知道自 己有多少个回复；再次，发表了一个回复和帖子也没有任何关系；其次，发表回复对帖子没有任何改变；从业务场景的角度去分析，我们有发表帖子的场景，有发表 回复的场景。当在发表回复的时候，是以回复为主体的，帖子只是这个回复里所包含的必要信息，用于说明这个回复是对哪个帖子的回复。这些都说明帖子和回复之 间找不出任何不变性约束的规则；因为帖子和回复都有各自独立的业务场景的需要，所以可以很容易理解它们都是独立的聚合根；那也很容易知道该如何建立他们之 间的关联了，但是我们要尽量减少关联，所以只保留回复对帖子的关联即可；帖子没有任何必要去保存一个回复的ID的列表；那么你可能会说，当我删除一个帖子 后，回复应该是没有存在的意义的呀？不对，不是没有存在的意义，而是删除了帖子后导致了回复对帖子的关联信息的缺失，导致数据不一致。这是因为帖子和回复 之间有一种必然的联系（1：N），回复一定会有一个对应的帖子；但是回复有其自己的生命周期，不应该随着帖子的删除而级联删除。这种情况下，如果你删除了 帖子，就导致回复也成为了一条无效的数据；所以，我们绝对不允许删除任何聚合根，因为一旦你删除了聚合根，那就意味着与该聚合根相关的其他任何聚合根都会 有外键引用缺失的问题，会导致整个领域模型数据的不一致；所以，永远都不要删除聚合根；

分类: [DDD 理论积累](https://www.cnblogs.com/netfocus/category/361987.html)

[好文要顶](javascript:void(0);) [关注我](javascript:void(0);) [收藏该文](javascript:void(0);) [![](https://common.cnblogs.com/images/icon_weibo_24.png)](javascript:void(0); "分享至新浪微博") [![](https://common.cnblogs.com/images/wechat.png)](javascript:void(0); "分享至微信")

[![](https://pic.cnblogs.com/face/13665/20190719142000.png)](https://home.cnblogs.com/u/netfocus/)

[netfocus](https://home.cnblogs.com/u/netfocus/)  
[关注 - 22](https://home.cnblogs.com/u/netfocus/followees/)  
[粉丝 - 3178](https://home.cnblogs.com/u/netfocus/followers/)

推荐博客

[+加关注](javascript:void(0);)

21

0

[«](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347923.html) 上一篇： [项目管理总结图](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347923.html "发布于 2012-02-12 14:08")  
[»](https://www.cnblogs.com/netfocus/archive/2012/09/06/2672736.html) 下一篇： [一点纯哲学](https://www.cnblogs.com/netfocus/archive/2012/09/06/2672736.html "发布于 2012-09-06 00:12")

### Feedback

[#1楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2307308)   
----------------------------------------------------------------------------------

2012-02-13 09:50 by [dax.net](https://www.cnblogs.com/daxnet/)

netfocus速度快啊，咱们刚刚讨论完，你就总结完了。哈哈！！

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#2楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2307311) \[楼主\]   
-----------------------------------------------------------------------------------------

2012-02-13 09:53 by [netfocus](https://www.cnblogs.com/netfocus/)

呵呵，要勤于记录，不然很快忘掉，最后没什么积累。记录下来也可以反复看，随着时间的推移知道其还有哪些不足的地方。

[支持(1)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#3楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2307343)   
----------------------------------------------------------------------------------

2012-02-13 10:23 by [dax.net](https://www.cnblogs.com/daxnet/)

[@](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2307311 "查看所回复的评论") netfocus  
是啊，我本来也想这周在博客中把这个问题说明一下。现在看来免啦。直接引用你的文章就可以了。

[支持(2)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#4楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2307422) \[楼主\]   
-----------------------------------------------------------------------------------------

2012-02-13 11:33 by [netfocus](https://www.cnblogs.com/netfocus/)

[@](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2307343 "查看所回复的评论") dax.net  
你也可以做一下你自己的总结，可能还是有一些不同的观点的。

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#5楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2307934)   
----------------------------------------------------------------------------------

2012-02-13 23:51 by [lcs-帅](https://www.cnblogs.com/luchaoshuai/)

订单模型我能理解.但是帖子和回复的模型.我一直理解不了.....

[支持(1)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#6楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2308076) \[楼主\]   
-----------------------------------------------------------------------------------------

2012-02-14 10:07 by [netfocus](https://www.cnblogs.com/netfocus/)

[@](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2307934 "查看所回复的评论") lcs-帅  
有什么地方有疑问？

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#7楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2308123)   
----------------------------------------------------------------------------------

2012-02-14 10:41 by [lcs-帅](https://www.cnblogs.com/luchaoshuai/)

没有帖子,就没有回复.觉得贴子就是回复他爹....

[支持(1)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#8楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2308250) \[楼主\]   
-----------------------------------------------------------------------------------------

2012-02-14 12:52 by [netfocus](https://www.cnblogs.com/netfocus/)

[引用](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2308123 "查看引用原文")lcs-帅：没有帖子,就没有回复.觉得贴子就是回复他爹....

  
帖子就算是回复的爹，那爹死了，儿子就要跟着死吗？  
帖子是回复的爹只是说明没有帖子被生出来就不可能有爹的儿子出世，但这个关系并不能说明爹死了儿子也必须跟着死。所以，帖子和回复是独立的，有自己的生命周期，就像爹和儿子是两个人，有各自的人生一样。

[支持(1)](javascript:void(0);) [反对(3)](javascript:void(0);)

[#9楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2308315)   
----------------------------------------------------------------------------------

2012-02-14 14:02 by [lcs-帅](https://www.cnblogs.com/luchaoshuai/)

我上面的比喻还真给你说倒了.....  
爹死了，儿子还真不要跟着死!!  
  
贴子跟回复.我觉得贴子没了,那回复也得跟着没有了..  
我是这样理解的...所以.贴子是根.回复只是贴子里面的一个可有可无的东东.

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#10楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2308575) \[楼主\]   
------------------------------------------------------------------------------------------

2012-02-14 17:50 by [netfocus](https://www.cnblogs.com/netfocus/)

帖子和回复之间的关系比较弱，不像订单和订单项一样是一个内聚的关系；  
帖子和回复以及回复的回复之间就像是一个链，帖子是链中的第一个结点，回复是第二个节点，回复的回复是第三个节点；帖子如果被删除了，就是这个链的头被移除了，但这个链的后面的结点还是在那里的。  
  
实际上你没什么理由一定要把帖子和回复内聚在一起成为一个整体的，这样做只会带来“大聚合”的各种问题，比如性能问题和并发问题。当我要发表回复时，每次都要取出帖子，然后往里面增加回复，然后保存整个帖子。在并发的情况下这是不行的。  
  
如果帖子和回复在一个聚合内，聚合意味着“修改数据的一个最小单元”，聚合内的所有对象要看成是一个整体最小单元进行保存。这么要求是因为聚合的意义是维护聚合内的不变性，数据一致性；  
  
仔细分析（我上面博文中分析过），你会发现帖子和回复之间没有数据一致性要求（你可以在看看我上面的分析，与订单模型的分析进行对比）。所以不需要设计在同一个聚合内。  
  
从场景的角度，我们有发表帖子，发表回复，这两个不同的场景，发表帖子创建的是帖子，而发表回复创建的是回复。但是订单就不一样，我们有创建订单，修改订单这两个场景。这两个场景都是围绕这订单这个聚合展开的。

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#11楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2315549)   
-----------------------------------------------------------------------------------

2012-02-23 19:11 by [Skyzi](https://www.cnblogs.com/Skyzi/)

我的这样的想法，在这里得到更好的验证。  
是的，最近在做一个帖子与回复的例子恍然大悟这个道理。。。

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#12楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2333047)   
-----------------------------------------------------------------------------------

2012-03-17 15:23 by [AndyHai](https://www.cnblogs.com/AndyHai/)

实体是只读的  
  
请问，这个该如何理解？

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#13楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2333143) \[楼主\]   
------------------------------------------------------------------------------------------

2012-03-17 18:08 by [netfocus](https://www.cnblogs.com/netfocus/)

[@](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2333047 "查看所回复的评论") AndyHai  
实体会被传递到聚合外部，但是因为实体在任何聚合外部不能被修改，否则聚合的不变性无法确保，所以不能被修改，必须只读。

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#14楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2333761) \[楼主\]   
------------------------------------------------------------------------------------------

2012-03-19 09:16 by [netfocus](https://www.cnblogs.com/netfocus/)

实体本来就和值对象一样，只不过在聚合内部有一个本地唯一的标识而已，而值对象没有唯一标识。这是唯一区别。

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#15楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2333765) \[楼主\]   
------------------------------------------------------------------------------------------

2012-03-19 09:17 by [netfocus](https://www.cnblogs.com/netfocus/)

当然，如果你的实体不会被传递到聚合外面的话，那实体可以不只读，因为它总是在聚合内部被修改，这样就没事。

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#16楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2361880)   
-----------------------------------------------------------------------------------

2012-04-23 11:34 by [AndyHai](https://www.cnblogs.com/AndyHai/)

永远不要删除聚合根，那么，Repository中的Remove岂不是根本无用的？

[支持(1)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#17楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2361895)   
-----------------------------------------------------------------------------------

2012-04-23 11:51 by [AndyHai](https://www.cnblogs.com/AndyHai/)

聚合根到聚合根：通过ID关联；  
  
那么，如果两个聚合根之间是多对多的关系，如何通过ID关联呢？ID集合吗？

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#18楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2362384) \[楼主\]   
------------------------------------------------------------------------------------------

2012-04-23 21:53 by [netfocus](https://www.cnblogs.com/netfocus/)

[@](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2361895 "查看所回复的评论") AndyHai  
1\. Repository中本来就不因该有Remove方法，Repository只有两个方法：1）GetById，2）Add  
2\. 1)尽量避免多对多的关系；2）如果必须多对多，那么用ID集合；

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#19楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2362510)   
-----------------------------------------------------------------------------------

2012-04-24 08:47 by [AndyHai](https://www.cnblogs.com/AndyHai/)

[引用](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2362384 "查看引用原文")netfocus：@AndyHai  
1\. Repository中本来就不因该有Remove方法，Repository只有两个方法：1）GetById，2）Add  
2\. 1)尽量避免多对多的关系；2）如果必须多对多，那么用ID集合；

  
嗯，谢谢楼主的回复，但是我看很多DDD的实践中，Repository中都还是有Remove的。而且，你不觉得聚合根永不删除会导致数据库性能问题吗？抑或者可以用标记的方式标记聚合根是“已删除”的状态，然后通过定期数据库维护来清除所有已标记为“已删除”状态的聚合根？

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#20楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2362550) \[楼主\]   
------------------------------------------------------------------------------------------

2012-04-24 09:15 by [netfocus](https://www.cnblogs.com/netfocus/)

1）其实不应该叫Remove，而应该叫作废，注销，禁用等操作；  
这种操作其实是先GetById把聚合根取出来，然后调用其作废方法，注销方法，或者禁用方法；直接Remove其实和Delete是同一个意思，体现不出业务含义，体现不出Remove背后真正的用户意图；你说的已删除状态标记是一种通用的表示对象不可用的标记，作为通用标记某个对象不可用你可以这样做，但业务上体现出来的最好是有业务含义的操作；  
  
2）关于你提到的性能问题，我们采用CQRS的架构，即Command Query Responsibility Segregation。存放处理业务逻辑的数据的表和仅用于显示数据的表是分开的。而处理业务逻辑的部分我们又是采用Event Sourcing来实现，并且还利用了快照的设计，不会有任何性能问题；命令与查询分离后，每一边需要负责处理的职责清晰，不需要为了对方而做一些妥协，自然各自都能更好的实现自己；

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#21楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2363408) \[楼主\]   
------------------------------------------------------------------------------------------

2012-04-25 09:23 by [netfocus](https://www.cnblogs.com/netfocus/)

[引用](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2362510 "查看引用原文")AndyHai：

引用netfocus：@AndyHai  
1\. Repository中本来就不因该有Remove方法，Repository只有两个方法：1）GetById，2）Add  
2\. 1)尽量避免多对多的关系；2）如果必须多对多，那么用ID集合；

  
嗯，谢谢楼主的回复，但是我看很多DDD的实践中，Repository中都还是有Remove的。而且，你不觉得聚合根永不删除会导致数据库性能问题吗？抑或者可以用标记的方式标记聚合根是“已删除”的状态，然后通过定期数据库维护来清除所有已标记为“已删除”状态的聚合根？

  
  
上面有一点说错了，如果是多对多，应该转换为两个一对多，然后都只要在双方对象中保存对方的ID即可；

[支持(2)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#22楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2449251)   
-----------------------------------------------------------------------------------

2012-08-15 23:06 by [Eric.HT](https://www.cnblogs.com/huting/)

1、上面提到“聚合根到聚合根之间通过ID去关联？”为什么不能通过引用去关联？  
自己确实没想明白这个问题，请指教。  
  
2、永远不要删除聚合根  
但就拿帖子回复这个业务场景来看，确实有需要删除帖子的操作。这如何说得通呢？还是我把两个东西搞混了？

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#23楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2459169)   
-----------------------------------------------------------------------------------

2012-08-29 16:34 by [Xia.CJ](https://www.cnblogs.com/xcj1989/)

永远不要删除聚合根...

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#24楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2476212)   
-----------------------------------------------------------------------------------

2012-09-19 10:40 by [冷凝\_涛](https://home.cnblogs.com/u/449443/)

[@](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2449251 "查看所回复的评论") Eric.HT  

[引用](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2449251 "查看引用原文")1、上面提到“聚合根到聚合根之间通过ID去关联？”为什么不能通过引用去关联？自己确实没想明白这个问题，请指教。  
  
2、永远不要删除聚合根  
但就拿帖子回复这个业务场景来看，确实有需要删除帖子的操作。这如何说得通呢？还是我把两个东西搞混了？

  
  
第一个问题我同样存在疑问  
另外,一个聚合根，如果订单到创建人的引用，那么对于这个创建用户，从概念上区分，它是对另外一个聚合根的引用？还是作为内部对象引用  
  
如果是聚合根引用，即用ID引用  
  
那如果出查询数据的时候，我查询出订单信息在界面上显示，需要显示创建用户（这样应该是普遍需求），我还要单独根据创建用户ID，去使用用户的仓储器进行查询？ 你的解决方式是什么？

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#25楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2479132)   
-----------------------------------------------------------------------------------

2012-09-22 21:06 by [雷运石](https://home.cnblogs.com/u/103210/)

[@](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2308123 "查看所回复的评论") lcs-帅  

[引用](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2308123 "查看引用原文")没有帖子,就没有回复.觉得贴子就是回复他爹....

  
帖子作为一个领域的头部都失去了，下面的子域还有意义吗？

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#26楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2479135)   
-----------------------------------------------------------------------------------

2012-09-22 21:06 by [雷运石](https://home.cnblogs.com/u/103210/)

[@](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2308250 "查看所回复的评论") netfocus  

[引用](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2308250 "查看引用原文")引用lcs-帅：没有帖子,就没有回复.觉得贴子就是回复他爹....帖子就算是回复的爹，那爹死了，儿子就要跟着死吗？  
帖子是回复的爹只是说明没有帖子被生出来就不可能有爹的儿子出世，但这个关系并不能说明爹死了儿子也必须跟着死。所以，帖子和回复是独立的，有自己的生命周期，就像爹和儿子是两个人，有各自的人生一样。

  
  
  
帖子作为一个领域的头部都失去了，下面的子域还有意义吗？

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#27楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2479165) \[楼主\]   
------------------------------------------------------------------------------------------

2012-09-22 22:13 by [netfocus](https://www.cnblogs.com/netfocus/)

帖子和回复的关系好比是一个链表，帖子是链表的头结点，回复是这个链表中的后面结点。但是你觉得链表的头结点“内聚”后面的结点吗？没有吧。这里帖子与回复的关系并不是包含关系，而只是串行关系。回复只是依赖于一个帖子而已。但是帖子不需要聚合回复。  
  
假设回复是帖子的子域，那必然创建回复的职责就落在帖子上，那就会有thread.AddPost(post), thread.RemovePost(post)这样类似的方法。你觉得自然码？为什么我要发表回复要通过帖子add or remove方法，而不是直接用postService.CreatePost(post), postService.DeletePost(post)这样的方法？  
  
我觉得很多人没有把聚合关系和串行链条关系的不同搞清楚。  
  
聚合的本质是逻辑上或物理上的容器与部分的关系，而关联关系的一种形式则是类似链表一样的串行关系，就像帖子与回复一样。  
  
就像我上面举的例子，帖子和回复就好比是父亲和儿子，当然你可以说没有父亲就没有儿子，这不假，但是这并不表示父亲内聚了儿子。实际上我们应该理解为儿子传承了父亲，什么是传承，难道不是像链表一样的链接关系吗？

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#28楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2755905)   
-----------------------------------------------------------------------------------

2013-08-20 13:33 by [鬼柒](https://www.cnblogs.com/7rhythm/)

到底什么是不变性约束呢？我看到你说分为两类“聚合边界内必须具有哪些信息，如果没有这些信息就不能称为一个有效的聚合；  
2）聚合内的某些对象的状态必须满足某个业务规则”  
  
这两个类别的说明 看不出跟 不变性有什么联系。所以不变性的本质是什么？什么东西是不变的？  
  
再者，在第一点中，边界必须具有某些信息，不然就不能称为有效聚合。这个说法好奇怪。。。。边界是由这个规则定的。规则又说必须具有某些信息才能是有效聚合，有效聚合又跟边界是有关的。  
  
就是说，我在找这些所谓的某些信息的时候，我要先弄清楚 什么样的才是有效聚合，然后我要确定这个有效聚合的边界是什么，然后我发现我需要用不变性规则来界定边界，最终 我还是回到了我要找某些信息。。。死循环。。。。

[支持(0)](javascript:void(0);) [反对(1)](javascript:void(0);)

[#29楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2874517)   
-----------------------------------------------------------------------------------

2014-02-12 20:10 by [遂昌樵夫](https://www.cnblogs.com/drabinlee/)

感觉是在讲☯，有黑白状态的变化。有行为运行，类似内部有生命周期性，这是一个聚合根。

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#30楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#2874524)   
-----------------------------------------------------------------------------------

2014-02-12 20:35 by [遂昌樵夫](https://www.cnblogs.com/drabinlee/)

聚合就像树，与传统的族谱树一样。易经二叉树和太玄三叉树

[支持(1)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#31楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#3236648)   
-----------------------------------------------------------------------------------

2015-07-28 10:11 by [GarySun](https://www.cnblogs.com/garysun90/)

写的真好，拜读

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#32楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#3518607)   
-----------------------------------------------------------------------------------

2016-09-24 15:28 by [路人甲某某](https://www.cnblogs.com/GardenApp/)

有水平，认真读过，觉得应当多次来阅读，才能更好消化。

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#33楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#3608174)   
-----------------------------------------------------------------------------------

2017-01-21 22:26 by [kid1412](https://www.cnblogs.com/kid1412/)

多谢分享!

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#34楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#3663361)   
-----------------------------------------------------------------------------------

2017-04-09 19:15 by [白纸无字Zonciu](https://home.cnblogs.com/u/1116542/)

永远不要删除聚合根？  
那帖子和回复这个例子里删帖的正确姿势是怎样？

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#35楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#3710765)   
-----------------------------------------------------------------------------------

2017-06-09 14:14 by [老老老老鱼](https://home.cnblogs.com/u/793267/)

菜鸟刚刚学习DDD，对例子2有不同的看法。  
帖子肯定应该有删除功能的，难么如果把帖子当做聚合根，那么根据业务员聚合根肯定是要删除的。  
那么这个例子可能就有点不合适了或者不应该将帖子当成聚合根，而应该将帖子当成一个实体。而且很多情况下一个实体就是一个聚合根，在语义上我们应该先把它当做是一个实体而不是聚合根。所以帖子是可以删除的。模式不能严格的照搬，就像有很多人反对严格的按照面向对象建模一样。

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#36楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#4018826)   
-----------------------------------------------------------------------------------

2018-07-12 14:30 by [天界法连](https://home.cnblogs.com/u/1417427/)

其实就是聚合根只包含聚合和组合两种关系，而如果两个对象间的关系是关联，则这两个对象间可能都是聚合根；

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)

[#37楼](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#4027880) \[楼主\]   
------------------------------------------------------------------------------------------

2018-07-24 21:07 by [netfocus](https://www.cnblogs.com/netfocus/)

[@](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#3710765 "查看所回复的评论") 老老老老鱼  

[引用](https://www.cnblogs.com/netfocus/archive/2012/02/12/2347938.html#3710765 "查看引用原文")菜鸟刚刚学习DDD，对例子2有不同的看法。  
帖子肯定应该有删除功能的，难么如果把帖子当做聚合根，那么根据业务员聚合根肯定是要删除的。  
那么这个例子可能就有点不合适了或者不应该将帖子当成聚合根，而应该将帖子当成一个实体。而且很多情况下一个实体就是一个聚合根，在语义上我们应该先把它当做是一个实体而不是聚合根。所以帖子是可以删除的。模式不能严格的照搬，就像有很多人反对严格的按照面向对象建模一样。  

  
你的回复我看不懂哦，能否在描述一下。比如“那么根据业务员聚合根肯定是要删除的。”

[支持(0)](javascript:void(0);) [反对(0)](javascript:void(0);)